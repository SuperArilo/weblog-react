tinymce.PluginManager.add('emojipack', instance => {
    instance.ui.registry.addButton(
        'emojipack',
        {
            icon: 'emojipack',
            tooltip: '常用表情',
            onAction: () => {
                const emojiClose = event => {
                    const dom = document.getElementById('emojiBox')
                    dom.classList.add('emoji-box-leave')
                    dom.getAnimations()[0].onfinish = () => {
                        dom.removeEventListener('click', emojiClose)
                        dom.remove()
                    }
                }
                if (document.getElementById('emojiBox') == null) {
                    const dom = `
                    <div id='emojiBox' class='emoji-box emoji-box-enter'>
                        <div class='emoji-box-title'>
                            <span>常用表情</span>
                            <div class='close-emoji' id='emojiClose'>关闭</div>
                        </div>
                        <div class='emoji-box-list' id='emojiBoxList'>
                            <div class='emoji-box-class-item'>
                                <span class='emoji-box-class-item-title'>猫猫虫</span>
                                <div class='emoji-box-class-item-list'>
                                    <img src='../../../5810F9689ABBE6B1CD93AF4E7F09A8DE.jpg' />
                                </div>
                            </div>
                            <div class='emoji-box-class-item'>
                                <span class='emoji-box-class-item-title'>猫猫虫</span>
                                <div class='emoji-box-class-item-list'>
                                    <img src='../../../5810F9689ABBE6B1CD93AF4E7F09A8DE.jpg' />
                                </div>
                            </div>
                            <div class='emoji-box-class-item'>
                                <span class='emoji-box-class-item-title'>猫猫虫</span>
                                <div class='emoji-box-class-item-list'>
                                    <img src='../../../5810F9689ABBE6B1CD93AF4E7F09A8DE.jpg' />
                                </div>
                            </div>
                            <div class='emoji-box-class-item'>
                                <span class='emoji-box-class-item-title'>猫猫虫</span>
                                <div class='emoji-box-class-item-list'>
                                    <img src='../../../5810F9689ABBE6B1CD93AF4E7F09A8DE.jpg' />
                                </div>
                            </div>
                        </div>
                    </div>
                    `
                    document.body.insertAdjacentHTML('beforeend', dom)
                    fetch(`${window.location.protocol}//${window.location.hostname}/api/funny/list`).then(resp => {
                        if (!resp.ok) {
                            throw new Error('网络请求失败')
                        }
                        // 将响应解析为 JSON 格式
                        return resp.json()
                    }).then(d => {
                        console.log(d)
                    }).catch(err => { console.log(err) })
                    document.getElementById('emojiClose').addEventListener('click', emojiClose)
                } else {
                    emojiClose()
                }
            }
        }
    )
})